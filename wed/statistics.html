<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thống Kê Kinh Doanh</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
</head>
<body class="bg-gray-100 flex">
    <!-- Sidebar Menu -->
    <aside class="w-64 bg-gray-800 text-white h-screen">
        <div class="p-4 text-center">
            <h1 class="text-2xl font-bold">Quản Lý Vị Cafe</h1>
            <p>Admin: Mr. Thanh <span class="text-sm">(Quản lý cấp cao)</span></p>
        </div>
        <nav class="mt-6 space-y-2">
            <a href="dashboard.html" class="block py-2 px-4 hover:bg-gray-700 rounded">Bảng Điều Khiển</a>
            <a href="user_management.html" class="block py-2 px-4 hover:bg-gray-700 rounded">Quản Lý Người Dùng</a>
            <a href="add_product.html" class="block py-2 px-4 hover:bg-gray-700 rounded">Quản Lý Sản Phẩm</a>
            <a href="order_management.html" class="block py-2 px-4 hover:bg-gray-700 rounded">Quản Lý Đơn Hàng</a>
            <a href="statistics.html" class="block py-2 px-4 bg-gray-700 rounded">Thống Kê Kinh Doanh</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 p-8">
        <h2 class="text-3xl font-bold mb-6">Thống Kê Kinh Doanh</h2>

        <!-- Date Range Filter -->
        <div class="mb-4 flex space-x-4">
            <div>
                <label class="block mb-2">Từ Ngày</label>
                <input type="date" id="startDate" class="p-2 border rounded">
            </div>
            <div>
                <label class="block mb-2">Đến Ngày</label>
                <input type="date" id="endDate" class="p-2 border rounded">
            </div>
            <button onclick="filterByDate()" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 mt-2 self-end">Lọc Thống Kê</button>
        </div>

        <!-- Product Statistics -->
        <h3 class="text-2xl font-bold mt-8 mb-4">Thống Kê Sản Phẩm</h3>
        <table class="min-w-full bg-white rounded-lg shadow-lg">
            <thead class="bg-gray-200">
                <tr>
                    <th class="py-3 px-6 text-left">Mặt Hàng</th>
                    <th class="py-3 px-6 text-left">Số Lượng Bán</th>
                    <th class="py-3 px-6 text-left">Tổng Doanh Thu</th>
                    <th class="py-3 px-6 text-left">Chi Tiết</th>
                </tr>
            </thead>
            <tbody id="productTable" class="divide-y divide-gray-200"></tbody>
        </table>

        <!-- Customer Statistics -->
        <h3 class="text-2xl font-bold mt-8 mb-4">Thống Kê Khách Hàng</h3>
        <table class="min-w-full bg-white rounded-lg shadow-lg">
            <thead class="bg-gray-200">
                <tr>
                    <th class="py-3 px-6 text-left">Khách Hàng</th>
                    <th class="py-3 px-6 text-left">Doanh Thu</th>
                    <th class="py-3 px-6 text-left">Chi Tiết</th>
                </tr>
            </thead>
            <tbody id="customerTable" class="divide-y divide-gray-200"></tbody>
        </table>

        <!-- Invoice Modal -->
        <div id="invoiceModal" class="fixed inset-0 hidden bg-gray-900 bg-opacity-50 flex items-center justify-center">
            <div class="bg-white p-6 rounded-lg w-96">
                <h4 class="text-xl font-bold mb-4" id="invoiceTitle">Chi Tiết Hóa Đơn</h4>
                <div id="invoiceContent" class="mb-4">
                    <!-- Invoice details will be dynamically added here -->
                </div>
                <button onclick="closeModal()" class="bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600">Đóng</button>
            </div>
        </div>

        <script>
            // Sample product data
            const products = [
                { id: 1, name: 'Cà Phê Đen', price: 30000, sales: 150 },
                { id: 2, name: 'Cà Phê Sữa', price: 22000, sales: 200 },
                { id: 3, name: 'Bạc Xỉu', price: 27000, sales: 100 },
                { id: 4, name: 'Trà Đào Cam Sả - Đá', price: 49000, sales: 50 },
                { id: 5, name: 'Trà Sữa Truyền Thống', price: 25000, sales: 110 },
                { id: 25, name: 'Chà Bông Phô Mai', price: 19000, sales: 20 },
                { id: 26, name: 'Mousse Tiramisu', price: 35000, sales: 10 },
                { id: 27, name: 'Mousse Gấu Chocolate', price: 39000, sales: 15 },
            ];

            // Sample customer data
            const customers = [
                { name: 'Mr.Thanh', revenue: 225000, purchases: [{ product: 'Cà Phê Đen', quantity: 5, price: 30000 },{ product: 'Mousse Tiramisu', quantity: 2, price: 35000 }] },
                { name: 'Đặng Văn Giang', revenue: 300000, purchases: [{ product: 'Cà Phê Sữa', quantity: 10, price: 22000 }] },
                // Add more customers as needed
            ];

            // Function to render product statistics and calculate totals
            function renderProductStatistics(filteredProducts) {
                const productTable = document.getElementById('productTable');
                productTable.innerHTML = '';

                let totalRevenue = 0;
                let maxSalesProduct = null;
                let minSalesProduct = null;

                (filteredProducts || products).forEach(product => {
                    const sales = product.sales; // Sử dụng số lượng bán thực tế từ dữ liệu
                    const totalProductRevenue = sales * product.price;
                    totalRevenue += totalProductRevenue;

                    // Xác định mặt hàng bán chạy nhất và ế nhất
                    if (!maxSalesProduct || sales > maxSalesProduct.sales) {
                        maxSalesProduct = { name: product.name, sales: sales };
                    }
                    if (!minSalesProduct || sales < minSalesProduct.sales) {
                        minSalesProduct = { name: product.name, sales: sales };
                    }

                    productTable.innerHTML += `
                        <tr>
                            <td class="py-4 px-6">${product.name}</td>
                            <td class="py-4 px-6">${sales}</td>
                            <td class="py-4 px-6">${totalProductRevenue.toLocaleString()} VNĐ</td>
                            <td class="py-4 px-6">
                                <a href="#" onclick="event.preventDefault(); viewInvoices('${product.name}', ${sales}, ${product.price})" class="text-blue-500 hover:underline">Xem Hóa Đơn</a>
                            </td>
                        </tr>
                    `;
                });

                // Hiển thị tổng doanh thu và mặt hàng bán chạy/ế nhất
                productTable.innerHTML += `
                    <tr class="font-bold">
                        <td class="py-4 px-6" colspan="2">Tổng Doanh Thu</td>
                        <td class="py-4 px-6">${totalRevenue.toLocaleString()} VNĐ</td>
                        <td class="py-4 px-6"></td>
                    </tr>
                    <tr>
                        <td class="py-4 px-6" colspan="2">Mặt Hàng Bán Chạy Nhất</td>
                        <td class="py-4 px-6" colspan="2">${maxSalesProduct.name} (${maxSalesProduct.sales} sản phẩm)</td>
                    </tr>
                    <tr>
                        <td class="py-4 px-6" colspan="2">Mặt Hàng Ế Nhất</td>
                        <td class="py-4 px-6" colspan="2">${minSalesProduct.name} (${minSalesProduct.sales} sản phẩm)</td>
                    </tr>
                `;
            }

            // Function to render customer statistics
            function renderCustomerStatistics(filteredCustomers) {
                const customerTable = document.getElementById('customerTable');
                customerTable.innerHTML = '';
                
                (filteredCustomers || customers).forEach(customer => {
                    customerTable.innerHTML += `
                        <tr>
                            <td class="py-4 px-6">${customer.name}</td>
                            <td class="py-4 px-6">${customer.revenue.toLocaleString()} VNĐ</td>
                            <td class="py-4 px-6">
                                <a href="#" onclick="event.preventDefault(); viewCustomerInvoices('${customer.name}')" class="text-blue-500 hover:underline">Xem Hóa Đơn</a>
                            </td>
                        </tr>
                    `;
                });
            }

            // Function to filter statistics by date
            function filterByDate() {
                // Implement date filtering logic here if needed
                renderProductStatistics(products);
                renderCustomerStatistics(customers);
            }

            // Function to view product invoices
            function viewInvoices(productName, sales, price) {
                const invoiceContent = `
                    <p><strong>Sản Phẩm:</strong> ${productName}</p>
                    <p><strong>Số Lượng Bán:</strong> ${sales}</p>
                    <p><strong>Giá:</strong> ${price.toLocaleString()} VNĐ</p>
                `;
                document.getElementById('invoiceContent').innerHTML = invoiceContent;
                document.getElementById('invoiceModal').classList.remove('hidden');
            }

            // Function to view customer invoices
            function viewCustomerInvoices(customerName) {
                const customer = customers.find(c => c.name === customerName);
                const invoiceContent = customer.purchases.map(purchase => `
                    <p>${purchase.product}: ${purchase.quantity} x ${purchase.price.toLocaleString()} VNĐ</p>
                `).join('');
                document.getElementById('invoiceContent').innerHTML = invoiceContent;
                document.getElementById('invoiceTitle').innerText = `Hóa Đơn của ${customerName}`;
                document.getElementById('invoiceModal').classList.remove('hidden');
            }

            // Function to close the modal
            function closeModal() {
                document.getElementById('invoiceModal').classList.add('hidden');
            }

            // Initial render
            renderProductStatistics(products);
            renderCustomerStatistics(customers);
        </script>
    </div>
</body>
</html>
